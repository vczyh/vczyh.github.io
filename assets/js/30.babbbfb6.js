(window.webpackJsonp=window.webpackJsonp||[]).push([[30],{512:function(a,s,t){"use strict";t.r(s);var e=t(4),n=Object(e.a)({},(function(){var a=this,s=a.$createElement,t=a._self._c||s;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("h2",{attrs:{id:"环境"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#环境"}},[a._v("#")]),a._v(" 环境")]),a._v(" "),t("p",[a._v("Ubuntu 16.04")]),a._v(" "),t("h2",{attrs:{id:"安装docker-ce"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装docker-ce"}},[a._v("#")]),a._v(" 安装Docker CE")]),a._v(" "),t("p",[a._v("若之前安装过老版本的"),t("code",[a._v("docker")]),a._v("，先卸载")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("apt-get")]),a._v(" remove docker docker-engine docker.io containerd runc\n")])])]),t("p",[a._v("1.更新"),t("code",[a._v("apt")]),a._v("包索引")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("apt-get")]),a._v(" update\n")])])]),t("p",[a._v("2.安装软件包支持"),t("code",[a._v("apt")]),a._v("使用基于Https的仓库")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("apt-get")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    apt-transport-https "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    ca-certificates "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("curl")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    gnupg-agent "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    software-properties-common\n")])])]),t("p",[a._v("3.添加Docker官方的GPG key")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 官方 ")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("curl")]),a._v(" -fsSL https://download.docker.com/linux/ubuntu/gpg "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" apt-key "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("add")]),a._v(" -\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 中科大镜像")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("curl")]),a._v(" -fsSL https://mirrors.ustc.edu.cn/docker-ce/linux/ubuntu/gpg "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" apt-key "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("add")]),a._v(" -\n")])])]),t("p",[a._v("验证key")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" apt-key fingerprint 0EBFCD88\n")])])]),t("p",[a._v("4.添加Docker仓库")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 官方")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" add-apt-repository "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n   "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"deb [arch=amd64] https://download.docker.com/linux/ubuntu \\\n   '),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$(")]),a._v("lsb_release -cs"),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v(")")])]),a._v(' \\\n   stable"')]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 中科大 速度快一点")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" add-apt-repository "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n   "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"deb [arch=amd64] https://mirrors.ustc.edu.cn/docker-ce/linux/ubuntu \\\n   '),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$(")]),a._v("lsb_release -cs"),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v(")")])]),a._v(' \\\n   stable"')]),a._v("\n\n")])])]),t("p",[a._v("5.更新"),t("code",[a._v("apt")]),a._v("包索引")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("apt-get")]),a._v(" update\n")])])]),t("p",[a._v("6.安装最新的Docker CE")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("apt-get")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" docker-ce docker-ce-cli containerd.io\n")])])]),t("h2",{attrs:{id:"查看版本信息"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#查看版本信息"}},[a._v("#")]),a._v(" 查看版本信息")]),a._v(" "),t("p",[a._v("查看Docker版本")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("docker --version\n\nDocker version "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("18.09")]),a._v(".3, build 774a1f4\n")])])]),t("p",[a._v("查看更多Docker信息，docker version 或者 docker info，这里使用"),t("code",[a._v("sudo")]),a._v("，否则会出现权限错误")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" docker info\n\nContainers: "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),a._v("\n Running: "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),a._v("\n Paused: "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),a._v("\n Stopped: "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),a._v("\nImages: "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),a._v("\nServer Version: "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("18.09")]),a._v(".3\nStorage Driver: overlay2\n Backing Filesystem: extfs\n Supports d_type: "),t("span",{pre:!0,attrs:{class:"token boolean"}},[a._v("true")]),a._v("\n Native Overlay Diff: "),t("span",{pre:!0,attrs:{class:"token boolean"}},[a._v("true")]),a._v("\nLogging Driver: json-file\nCgroup Driver: cgroupfs\nPlugins:\n Volume: "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("local")]),a._v("\n Network: bridge "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("host")]),a._v(" macvlan null overlay\n Log: awslogs fluentd gcplogs gelf journald json-file "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("local")]),a._v(" logentries splunk syslog\nSwarm: inactive\nRuntimes: runc\nDefault Runtime: runc\nInit Binary: docker-init\ncontainerd version: e6b3f5632f50dbc4e9cb6288d911bf4f5e95b18e\nrunc version: 6635b4f0c6af3810594d2770f662f34ddc15b40d\ninit version: fec3683\nSecurity Options:\n apparmor\n seccomp\n  Profile: default\nKernel Version: "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("4.4")]),a._v(".0-131-generic\nOperating System: Ubuntu "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("16.04")]),a._v(".5 LTS\nOSType: linux\nArchitecture: x86_64\nCPUs: "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v("\nTotal Memory: "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("974")]),a._v(".2MiB\nName: ubuntu\nID: DZ4R:PP5P:IRNO:OSCE:A55B:MMZ2:EZ25:JKHW:NK7I:JW2P:Y4U7:ESAW\nDocker Root Dir: /var/lib/docker\nDebug Mode "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("client"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(": "),t("span",{pre:!0,attrs:{class:"token boolean"}},[a._v("false")]),a._v("\nDebug Mode "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("server"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(": "),t("span",{pre:!0,attrs:{class:"token boolean"}},[a._v("false")]),a._v("\nRegistry: https://index.docker.io/v1/\nLabels:\nExperimental: "),t("span",{pre:!0,attrs:{class:"token boolean"}},[a._v("false")]),a._v("\nInsecure Registries:\n "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("127.0")]),a._v(".0.0/8\nLive Restore Enabled: "),t("span",{pre:!0,attrs:{class:"token boolean"}},[a._v("false")]),a._v("\nProduct License: Community Engine\n\n")])])]),t("p",[a._v("一般使用docker命令得加上"),t("code",[a._v("sudo")]),a._v("，为了避免出现权限错误 ，设置把用户加入到docker组中 "),t("a",{attrs:{href:"https://docs.docker.com/engine/installation/linux/linux-postinstall/",target:"_blank",rel:"noopener noreferrer"}},[a._v("Read more"),t("OutboundLink")],1),a._v(".")]),a._v(" "),t("p",[a._v("创建docker用户组，可能会提示已经存在")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("groupadd")]),a._v(" docker\n")])])]),t("p",[a._v("把用户添加到docker用户组")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("usermod")]),a._v(" -aG docker "),t("span",{pre:!0,attrs:{class:"token environment constant"}},[a._v("$USER")]),a._v("\n")])])]),t("p",[a._v("登出账号")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("logout")]),a._v("\n")])])]),t("p",[a._v("然后重新登录，现在不加"),t("code",[a._v("sudo")]),a._v("也可以使用")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("docker info\n")])])]),t("h2",{attrs:{id:"测试"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#测试"}},[a._v("#")]),a._v(" 测试")]),a._v(" "),t("p",[a._v("通过运行一个简单的"),t("code",[a._v("image")]),a._v("来测试Docker")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("$ docker run hello-world\n\nUnable to "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("find")]),a._v(" image "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'hello-world:latest'")]),a._v(" locally\ndocker: Error response from daemon: Get https://registry-1.docker.io/v2/library/hello-world/manifests/latest: Get https://auth.docker.io/token?scope"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("repository%3Alibrary%2Fhello-world%3Apull"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("&")]),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("service")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("registry.docker.io: net/http: request canceled "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("Client.Timeout exceeded "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("while")]),a._v(" awaiting headers"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(".\nSee "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'docker run --help'")]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v(".")]),a._v("\n")])])]),t("p",[t("strong",[a._v("错误解决：")])]),a._v(" "),t("p",[t("strong",[a._v("打开"),t("code",[a._v("/etc/docker/daemon.json")]),a._v("，如果不存在创建文件，添加内容")])]),a._v(" "),t("div",{staticClass:"language-json extra-class"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[a._v('"registry-mirrors"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"http://141e5461.m.daocloud.io"')]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])])]),t("p",[t("strong",[a._v("重启Docker服务")])]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("service")]),a._v(" docker restart\n")])])]),t("p",[a._v("再次运行")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("$ docker run hello-world\n\nUnable to "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("find")]),a._v(" image "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'hello-world:latest'")]),a._v(" locally\nlatest: Pulling from library/hello-world\n1b930d010525: Pull complete \nDigest: sha256:92c7f9c92844bbbb5d0a101b22f7c2a7949e40f8ea90c8b3bc396879d95e899a\nStatus: Downloaded newer image "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("for")]),a._v(" hello-world:latest\n\nHello from Docker"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("!")]),a._v("\nThis message shows that your installation appears to be working correctly.\n\nTo generate this message, Docker took the following steps:\n "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v(". The Docker client contacted the Docker daemon.\n "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("2")]),a._v(". The Docker daemon pulled the "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"hello-world"')]),a._v(" image from the Docker Hub.\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("amd64"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("3")]),a._v(". The Docker daemon created a new container from that image "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("which")]),a._v(" runs the\n    executable that produces the output you are currently reading.\n "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("4")]),a._v(". The Docker daemon streamed that output to the Docker client, "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("which")]),a._v(" sent it\n    to your terminal.\n\nTo try something "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("more")]),a._v(" ambitious, you can run an Ubuntu container with:\n $ docker run -it ubuntu "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("bash")]),a._v("\n\nShare images, automate workflows, and "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("more")]),a._v(" with a "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("free")]),a._v(" Docker ID:\n https://hub.docker.com/\n\nFor "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("more")]),a._v(" examples and ideas, visit:\n https://docs.docker.com/get-started/\n\n")])])]),t("p",[a._v("查看下载的"),t("code",[a._v("image")])]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("$ docker image "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("ls")]),a._v("\nREPOSITORY          TAG                 IMAGE ID            CREATED             SIZE\nhello-world         latest              fce289e99eb9        "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("2")]),a._v(" months ago        "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v(".84kB\n\n")])])]),t("p",[a._v("列出所有的容器，不加"),t("code",[a._v("--all")]),a._v("默认列出仍在运行的容器，"),t("code",[a._v("hello-world")]),a._v("输出语句后就结束了，因此不加"),t("code",[a._v("--all")]),a._v("就看不到"),t("code",[a._v("hello-world")]),a._v("容器")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("docker container "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("ls")]),a._v(" --all\n")])])]),t("h2",{attrs:{id:"containers"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#containers"}},[a._v("#")]),a._v(" Containers")]),a._v(" "),t("p",[a._v("简单来说，"),t("code",[a._v("Container")]),a._v("就是包含运行环境，代码，以及构建运行命令的容器，他和传统运行程序的区别就是环境不随宿主机的环境变化，自己拥有自己的一套运行环境，环境变量，可以通过端口与宿主机交流信息。下面示例构建了一个容器：")]),a._v(" "),t("p",[a._v("在新建文件夹下，添加三个文件")]),a._v(" "),t("p",[t("strong",[a._v("Dockerfile")])]),a._v(" "),t("div",{staticClass:"language-dockerfile extra-class"},[t("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 程序运行需要的环境，也是一个镜像")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# Use an official Python runtime as a parent image")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("FROM")]),a._v(" python"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("2.7"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("slim\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# Set the working directory to /app")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("WORKDIR")]),a._v(" /app\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# Copy the current directory contents into the container at /app")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("COPY")]),a._v(" . /app\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 需要运行的命令，这里使用pip安装需要的模块")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# Install any needed packages specified in requirements.txt")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("RUN")]),a._v(" pip install "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("trusted"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("host pypi.python.org "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("r requirements.txt\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 暴露80端口")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# Make port 80 available to the world outside this container")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("EXPOSE")]),a._v(" 80\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 定义环境变量")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# Define environment variable")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("ENV")]),a._v(" NAME World\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 当容器运行的时候执行的命令")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# Run app.py when the container launches")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("CMD")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"python"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"app.py"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n")])])]),t("p",[t("strong",[a._v("requirements.txt")])]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("Flask\nRedis\n")])])]),t("p",[t("strong",[a._v("app.py")])]),a._v(" "),t("div",{staticClass:"language-python extra-class"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("from")]),a._v(" flask "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("import")]),a._v(" Flask\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("from")]),a._v(" redis "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("import")]),a._v(" Redis"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" RedisError\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("import")]),a._v(" os\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("import")]),a._v(" socket\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# Connect to Redis")]),a._v("\nredis "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" Redis"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("host"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"redis"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" db"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" socket_connect_timeout"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" socket_timeout"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n\napp "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" Flask"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("__name__"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token decorator annotation punctuation"}},[a._v("@app"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("route")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"/"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("def")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("hello")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("try")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n        visits "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" redis"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("incr"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"counter"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("except")]),a._v(" RedisError"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n        visits "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"<i>cannot connect to Redis, counter disabled</i>"')]),a._v("\n\n    html "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"<h3>Hello {name}!</h3>"')]),a._v(" \\\n           "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"<b>Hostname:</b> {hostname}<br/>"')]),a._v(" \\\n           "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"<b>Visits:</b> {visits}"')]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("return")]),a._v(" html"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token builtin"}},[a._v("format")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("name"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("os"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("getenv"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"NAME"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"world"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" hostname"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("socket"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("gethostname"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" visits"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("visits"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("if")]),a._v(" __name__ "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("==")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"__main__"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    app"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("run"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("host"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'0.0.0.0'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" port"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("80")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n")])])]),t("h3",{attrs:{id:"构建应用"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#构建应用"}},[a._v("#")]),a._v(" 构建应用")]),a._v(" "),t("p",[a._v("当前的目录结构")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("ls")]),a._v("\nDockerfile\t\tapp.py\t\t\trequirements.txt\n")])])]),t("p",[t("code",[a._v("--tag")]),a._v("设置镜像的名字，可以使用"),t("code",[a._v("-t")]),a._v("代替")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("docker build --tag"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("friendlyhello "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v(".")]),a._v("\n\nSending build context to Docker daemon   "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("5")]),a._v(".12kB\nStep "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v("/7 "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v(":")]),a._v(" FROM python:2.7-slim\n"),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("2.7")]),a._v("-slim: Pulling from library/python\n6ae821421a7d: Pull complete \nead11ecb9832: Pull complete \nd1ef2eb755bd: Pull complete \n1c63dfc85c0a: Pull complete \nDigest: sha256:8a5111aceb7e0cf0cf7f31e37578e333d86ed617ca9edf3b65e18863e45b2a30\nStatus: Downloaded newer image "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("for")]),a._v(" python:2.7-slim\n ---"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" f2ac6489d817\nStep "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("2")]),a._v("/7 "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v(":")]),a._v(" WORKDIR /app\n ---"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" Running "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("in")]),a._v(" 932187809e8e\nRemoving intermediate container 932187809e8e\n ---"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" b3cfe9d5f91d\nStep "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("3")]),a._v("/7 "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v(":")]),a._v(" COPY "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v(".")]),a._v(" /app\n ---"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" 5585f2e23654\nStep "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("4")]),a._v("/7 "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v(":")]),a._v(" RUN pip "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" --trusted-host pypi.python.org -r requirements.txt\n ---"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" Running "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("in")]),a._v(" bc57918cd3f9\nDEPRECATION: Python "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("2.7")]),a._v(" will reach the end of its life on January 1st, "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("2020")]),a._v(". Please upgrade your Python as Python "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("2.7")]),a._v(" won"),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'t be maintained after that date. A future version of pip will drop support for Python 2.7.\nCollecting Flask (from -r requirements.txt (line 1))\n  Downloading https://files.pythonhosted.org/packages/7f/e7/08578774ed4536d3242b14dacb4696386634607af824ea997202cd0edb4b/Flask-1.0.2-py2.py3-none-any.whl (91kB)\nCollecting Redis (from -r requirements.txt (line 2))\n  Downloading https://files.pythonhosted.org/packages/d0/8b/c43ef27d02382853b22c49bc41a8389e47d60811dd1d72b9a45bc905a5f8/redis-3.2.0-py2.py3-none-any.whl (65kB)\nCollecting itsdangerous>=0.24 (from Flask->-r requirements.txt (line 1))\n  Downloading https://files.pythonhosted.org/packages/76/ae/44b03b253d6fade317f32c24d100b3b35c2239807046a4c953c7b89fa49e/itsdangerous-1.1.0-py2.py3-none-any.whl\nCollecting Jinja2>=2.10 (from Flask->-r requirements.txt (line 1))\n  Downloading https://files.pythonhosted.org/packages/7f/ff/ae64bacdfc95f27a016a7bed8e8686763ba4d277a78ca76f32659220a731/Jinja2-2.10-py2.py3-none-any.whl (126kB)\nCollecting Werkzeug>=0.14 (from Flask->-r requirements.txt (line 1))\n  Downloading https://files.pythonhosted.org/packages/20/c4/12e3e56473e52375aa29c4764e70d1b8f3efa6682bef8d0aae04fe335243/Werkzeug-0.14.1-py2.py3-none-any.whl (322kB)\nCollecting click>=5.1 (from Flask->-r requirements.txt (line 1))\n  Downloading https://files.pythonhosted.org/packages/fa/37/45185cb5abbc30d7257104c434fe0b07e5a195a6847506c074527aa599ec/Click-7.0-py2.py3-none-any.whl (81kB)\nCollecting MarkupSafe>=0.23 (from Jinja2>=2.10->Flask->-r requirements.txt (line 1))\n  Retrying (Retry(total=4, connect=None, read=None, redirect=None, status=None)) after connection broken by '")]),a._v("ReadTimeoutError"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("\"HTTPSConnectionPool(host='files.pythonhosted.org', port=443): Read timed out. (read timeout=15)\"")]),a._v(","),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("': /packages/fb/40/f3adb7cf24a8012813c5edb20329eb22d5d8e2a0ecf73d21d6b85865da11/MarkupSafe-1.1.1-cp27-cp27mu-manylinux1_x86_64.whl\n  Downloading https://files.pythonhosted.org/packages/fb/40/f3adb7cf24a8012813c5edb20329eb22d5d8e2a0ecf73d21d6b85865da11/MarkupSafe-1.1.1-cp27-cp27mu-manylinux1_x86_64.whl\nInstalling collected packages: itsdangerous, MarkupSafe, Jinja2, Werkzeug, click, Flask, Redis\nSuccessfully installed Flask-1.0.2 Jinja2-2.10 MarkupSafe-1.1.1 Redis-3.2.0 Werkzeug-0.14.1 click-7.0 itsdangerous-1.1.0\nRemoving intermediate container bc57918cd3f9\n ---"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" b153aab474c9\nStep "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("5")]),a._v("/7 "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v(":")]),a._v(" EXPOSE "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("80")]),a._v("\n ---"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" Running "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("in")]),a._v(" 045106266e34\nRemoving intermediate container 045106266e34\n ---"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" 27c4772dab6c\nStep "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("6")]),a._v("/7 "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v(":")]),a._v(" ENV NAME World\n ---"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" Running "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("in")]),a._v(" e15dbdd45e6e\nRemoving intermediate container e15dbdd45e6e\n ---"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" 9e0bbdc1b815\nStep "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("7")]),a._v("/7 "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v(":")]),a._v(" CMD "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"python"')]),a._v(", "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"app.py"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n ---"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" Running "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("in")]),a._v(" 128e9167ee7a\nRemoving intermediate container 128e9167ee7a\n ---"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" bad504f1ce1a\nSuccessfully built bad504f1ce1a\nSuccessfully tagged friendlyhello:latest\n\n")])])]),t("p",[a._v("查看镜像，这里显示了所有本地镜像，包括刚构建的以及从远程仓库下载的")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("$ docker image "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("ls")]),a._v("\nREPOSITORY          TAG                 IMAGE ID            CREATED             SIZE\nfriendlyhello       latest              bad504f1ce1a        "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("9")]),a._v(" minutes ago       131MB\npython              "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("2.7")]),a._v("-slim            f2ac6489d817        "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("9")]),a._v(" days ago          120MB\nhello-world         latest              fce289e99eb9        "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("2")]),a._v(" months ago        "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v(".84kB\n\n")])])]),t("h3",{attrs:{id:"运行应用"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#运行应用"}},[a._v("#")]),a._v(" 运行应用")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("$ docker run -p "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("4000")]),a._v(":80 friendlyhello\n * Serving Flask app "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"app"')]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("lazy loading"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n * Environment: production\n   WARNING: Do not use the development server "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("in")]),a._v(" a production environment.\n   Use a production WSGI server instead.\n * Debug mode: off\n * Running on http://0.0.0.0:80/ "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("Press CTRL+C to quit"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n")])])]),t("p",[t("code",[a._v("-p 4000:80")]),a._v("将宿主机的4000端口映射到容器的80端口")]),a._v(" "),t("p",[a._v("访问"),t("code",[a._v("http://宿主机IP:4000")])]),a._v(" "),t("p",[t("img",{attrs:{src:"http://p.vczyh.com/blog/20190303/lwaBhpRnXtEM.png?imageslim",alt:"mark"}})]),a._v(" "),t("p",[a._v("在终端按"),t("code",[a._v("CTRL+C")]),a._v("停止容器")]),a._v(" "),t("p",[t("strong",[a._v("在后台运行app")])]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("$ docker run -d -p "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("4000")]),a._v(":80 friendlyhello\n\nd5d06d6b7efc6c9e8e2e730ee0139c78200951743df80afd0ce2bc604da917a1\n")])])]),t("p",[t("code",[a._v("d5d06d6b7efc6c9e8e2e730ee0139c78200951743df80afd0ce2bc604da917a1")]),a._v("是容器ID，每个运行的容器实例都有一个ID")]),a._v(" "),t("p",[t("strong",[a._v("查看运行的容器")])]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("$ youthful_mirzakhani\nCONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS                  NAMES\nd5d06d6b7efc        friendlyhello       "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"python app.py"')]),a._v("     "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("9")]),a._v(" seconds ago       Up "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("8")]),a._v(" seconds        "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("0.0")]),a._v(".0.0:4000-"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("80")]),a._v("/tcp   youthful_mirzakhani\n\n")])])]),t("p",[t("strong",[a._v("停止运行app")])]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v(" docker container stop d5d06d6b7efc\n")])])]),t("p",[t("strong",[a._v("或者")])]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("docker container stop youthful_mirzakhani\n")])])]),t("p",[t("code",[a._v("youthful_mirzakhani")]),a._v("是实例的"),t("code",[a._v("NAMES")]),a._v("属性")]),a._v(" "),t("h3",{attrs:{id:"分享镜像"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#分享镜像"}},[a._v("#")]),a._v(" 分享镜像")]),a._v(" "),t("p",[t("strong",[a._v("使用官方Registry非常慢，这里只是学习一下，建议使用其他Registry")]),a._v(" "),t("a",{attrs:{href:"https://blog.csdn.net/TKDK_bot/article/details/88097069",target:"_blank",rel:"noopener noreferrer"}},[a._v("阿里云容器镜像服务的基本使用"),t("OutboundLink")],1)]),a._v(" "),t("p",[a._v("Docker支持将镜像上传到一个类似"),t("code",[a._v("Github")]),a._v("和"),t("code",[a._v("Maven")]),a._v("的公共仓库，需要在 "),t("a",{attrs:{href:"https://hub.docker.com/",target:"_blank",rel:"noopener noreferrer"}},[a._v("hub.docker.com"),t("OutboundLink")],1),a._v(" 注册账号")]),a._v(" "),t("p",[t("strong",[a._v("登录Docker账号")])]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("$ docker login\nLogin with your Docker ID to push and pull images from Docker Hub. If you don't have a Docker ID, "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("head")]),a._v(" over to https://hub.docker.com to create one.\nUsername: vczyh\nPassword: \nWARNING"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("!")]),a._v(" Your password will be stored unencrypted "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("in")]),a._v(" /home/vczyh/.docker/config.json.\nConfigure a credential helper to remove this warning. See\nhttps://docs.docker.com/engine/reference/commandline/login/"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#credentials-store")]),a._v("\n\nLogin Succeeded\n")])])]),t("p",[t("strong",[a._v("为镜像打标签")])]),a._v(" "),t("p",[a._v("格式")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("docker tag image username/repository:tag\n")])])]),t("p",[a._v("例如")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("docker tag friendlyhello vczyh/get-started:part2\n")])])]),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("$ docker image "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("ls")]),a._v("\nREPOSITORY          TAG                 IMAGE ID            CREATED             SIZE\nfriendlyhello       latest              bad504f1ce1a        About an hour ago   131MB\nvczyh/get-started   part2               bad504f1ce1a        About an hour ago   131MB\npython              "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("2.7")]),a._v("-slim            f2ac6489d817        "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("9")]),a._v(" days ago          120MB\nhello-world         latest              fce289e99eb9        "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("2")]),a._v(" months ago        "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v(".84kB\n")])])]),t("p",[t("strong",[a._v("发布镜像")])]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("docker push username/repository:tag\n")])])]),t("p",[t("strong",[a._v("拉取镜像并运行")])]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("docker run -p "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("4000")]),a._v(":80 username/repository:tag\n")])])]),t("h2",{attrs:{id:"services"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#services"}},[a._v("#")]),a._v(" Services")]),a._v(" "),t("p",[a._v("在分布式应用中，不同的部分被称为服务。比如，你想做一个视频分享网站，网站可能包括存储服务，用户上传视频后的转码服务，前台服务等。")]),a._v(" "),t("p",[a._v("服务实际上只是生产中的容器，一个服务仅运行一个镜像，但它通过编码决定了镜像的运行方式——使用的端口，运行副本的数量，便于容器拥有它所需要的容量等。拓展服务改变了运行软件的容器实例数量，从而为进程中的服务分配更多的资源。")]),a._v(" "),t("p",[a._v("幸运的是，使用Docker平台定义、运行和扩展服务非常容易——只需编写一个"),t("code",[a._v("docker-compose.yml")]),a._v("文件。")]),a._v(" "),t("p",[t("code",[a._v("docker-compose.yml")]),a._v("文件是一个YAML文件，它定义Docker容器在生产环境中的行为。")]),a._v(" "),t("p",[t("strong",[a._v("docker-compose.yml")])]),a._v(" "),t("div",{staticClass:"language-yaml extra-class"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("version")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"3"')]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("services")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 定义一个叫web的服务")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("web")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  \t"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 镜像，本地或者远程")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# replace username/repo:tag with your name and image details")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# image: username/repo:tag")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("image")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" registry.cn"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("hangzhou.aliyuncs.com/zhangyuheng/hello \n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("deploy")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n      "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 包含5个副本")]),a._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("replicas")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("5")]),a._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("resources")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("limits")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n          "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 每个副本最多使用10%的CPU")]),a._v("\n          "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("cpus")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"0.1"')]),a._v("\n          "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 每个副本最多使用50M内存空间")]),a._v("\n          "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("memory")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" 50M\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("restart_policy")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 如果有任何一个失败，则立即重启")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("condition")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" on"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("failure\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("ports")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n      "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 将主机4000端口映射到web服务的80端口")]),a._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"4000:80"')]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("networks")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n      "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 指示web容器通过称为webnet的负载均衡网络共享80端口(在内部，容器本身在一个临时端口上发布到web的80端口。)")]),a._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" webnet\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("networks")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 使用默认设置定义webnet网络(一个负载均衡的覆盖网络)。")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("webnet")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n")])])]),t("h3",{attrs:{id:"运行你的负载均衡应用"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#运行你的负载均衡应用"}},[a._v("#")]),a._v(" 运行你的负载均衡应用")]),a._v(" "),t("p",[a._v("首先先运行：")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("$ docker swarm init\n\nSwarm initialized: current node "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("7qrexnk3iv5uj501v2rc4h7qh"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" is now a manager.\n\nTo "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("add")]),a._v(" a worker to this swarm, run the following command:\n\n    docker swarm "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("join")]),a._v(" --token SWMTKN-1-4auxfpbmrbtxolwcv8iarukaq6pvkythefg43smvhdsroa8myy-162ysnb7pb05nrobv9b85rznj "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("192.168")]),a._v(".255.130:2377\n\nTo "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("add")]),a._v(" a manager to this swarm, run "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'docker swarm join-token manager'")]),a._v(" and follow the instructions.\n")])])]),t("p",[t("code",[a._v("getstartedlab")]),a._v("是app的名字：")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("$ docker stack deploy -c docker-compose.yml getstartedlab\n\nCreating network getstartedlab_webnet\nCreating "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("service")]),a._v(" getstartedlab_web\n")])])]),t("p",[a._v("现在单个服务堆栈在一台主机上运行了5个已部署镜像的实例")]),a._v(" "),t("p",[a._v("查看服务：")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("$ docker "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("service")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("ls")]),a._v("\n\nID                  NAME                MODE                REPLICAS            IMAGE                                                     PORTS\n343zdnqqcspv        getstartedlab_web   replicated          "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("5")]),a._v("/5                 registry.cn-hangzhou.aliyuncs.com/zhangyuheng/hello:1.0   *:4000-"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("80")]),a._v("/tcp\n")])])]),t("p",[a._v("也可以这样查看服务：")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("$ docker stack services getstartedlab \n\nID                  NAME                MODE                REPLICAS            IMAGE                                                     PORTS\n343zdnqqcspv        getstartedlab_web   replicated          "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("5")]),a._v("/5                 registry.cn-hangzhou.aliyuncs.com/zhangyuheng/hello:1.0   *:4000-"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("80")]),a._v("/tcp\n")])])]),t("p",[a._v("服务中运行的单个容器称为任务。任务被赋予惟一的id，这些id在数字上递增，直到您在"),t("code",[a._v("docker-comp.yml")]),a._v("中定义的副本的数量。")]),a._v(" "),t("p",[a._v("列出你的服务任务：")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("$ docker "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("service")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("ps")]),a._v(" getstartedlab_web \n\nID                  NAME                  IMAGE                                                     NODE                DESIRED STATE       CURRENT STATE           ERROR               PORTS\nsgwe31kih992        getstartedlab_web.1   registry.cn-hangzhou.aliyuncs.com/zhangyuheng/hello:1.0   ubuntu              Running             Running "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("9")]),a._v(" minutes ago                       \numx73o2ndmed        getstartedlab_web.2   registry.cn-hangzhou.aliyuncs.com/zhangyuheng/hello:1.0   ubuntu              Running             Running "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("9")]),a._v(" minutes ago                       \nu32n0jmlkc6k        getstartedlab_web.3   registry.cn-hangzhou.aliyuncs.com/zhangyuheng/hello:1.0   ubuntu              Running             Running "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("9")]),a._v(" minutes ago                       \nyi0giwz62y3d        getstartedlab_web.4   registry.cn-hangzhou.aliyuncs.com/zhangyuheng/hello:1.0   ubuntu              Running             Running "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("9")]),a._v(" minutes ago                       \nnaxqp1nsxxaq        getstartedlab_web.5   registry.cn-hangzhou.aliyuncs.com/zhangyuheng/hello:1.0   ubuntu              Running             Running "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("9")]),a._v(" minutes ago \n")])])]),t("p",[a._v("也可以通过查看容器来查看任务："),t("code",[a._v("-q")]),a._v("仅仅列出容器ID")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("docker container "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("ls")]),a._v("\n")])])]),t("p",[a._v("浏览器多次访问："),t("code",[a._v("http://localhost:4000")])]),a._v(" "),t("p",[a._v("或者多次输入：")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("curl")]),a._v(" -4 http://localhost:4000\n")])])]),t("p",[a._v("可以看到显示的"),t("strong",[a._v("Hostname")]),a._v("("),t("strong",[a._v("容器ID")]),a._v(")每次都不一样，也验证了轮询方式的负载均衡")]),a._v(" "),t("p",[a._v("显示一个"),t("strong",[a._v("stack")]),a._v("的所有任务：")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("docker stack "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("ps")]),a._v(" getstartedlab\n")])])]),t("h3",{attrs:{id:"拓展应用"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#拓展应用"}},[a._v("#")]),a._v(" 拓展应用")]),a._v(" "),t("p",[a._v("可以通过改变"),t("code",[a._v("replicas")]),a._v(" 的值来拓展应用：")]),a._v(" "),t("p",[t("strong",[a._v("docker-compose.yml")])]),a._v(" "),t("div",{staticClass:"language-yaml extra-class"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[a._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("deploy")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n      "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 包含5个副本")]),a._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("replicas")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("7")]),a._v("\n")])])]),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("docker stack deploy -c docker-compose.yml getstartedlab\n")])])]),t("p",[a._v("Docker更新服务不需要关掉服务或者关掉任何容器")]),a._v(" "),t("p",[a._v("查看目前的容器和任务：")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("docker stack "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("ps")]),a._v(" getstartedlab\n")])])]),t("h3",{attrs:{id:"移除应用"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#移除应用"}},[a._v("#")]),a._v(" 移除应用")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("docker stack "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("rm")]),a._v(" getstartedlab\n")])])]),t("h3",{attrs:{id:"移除集群"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#移除集群"}},[a._v("#")]),a._v(" 移除集群")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("docker swarm leave --force\n")])])]),t("h3",{attrs:{id:"常用命令"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#常用命令"}},[a._v("#")]),a._v(" 常用命令")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("docker stack "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("ls")]),a._v("                                            "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# List stacks or apps")]),a._v("\ndocker stack deploy -c "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("composefile"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("appname"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# Run the specified Compose file")]),a._v("\ndocker "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("service")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("ls")]),a._v("                 "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# List running services associated with an app")]),a._v("\ndocker "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("service")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("ps")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("service"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("                  "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# List tasks associated with an app")]),a._v("\ndocker inspect "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("task or container"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("                   "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# Inspect task or container")]),a._v("\ndocker container "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("ls")]),a._v(" -q                                      "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# List container IDs")]),a._v("\ndocker stack "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("rm")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("appname"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("                             "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# Tear down an application")]),a._v("\ndocker swarm leave --force      "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# Take down a single node swarm from the manager")]),a._v("\n")])])]),t("h2",{attrs:{id:"swarms"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#swarms"}},[a._v("#")]),a._v(" Swarms")]),a._v(" "),t("h3",{attrs:{id:"安装docker-machine"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装docker-machine"}},[a._v("#")]),a._v(" 安装docker-machine")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("$ "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("base")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("https://github.com/docker/machine/releases/download/v0.16.0 "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("&&")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("curl")]),a._v(" -L "),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$base")]),a._v("/docker-machine-"),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$(")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("uname")]),a._v(" -s"),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v(")")])]),a._v("-"),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$(")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("uname")]),a._v(" -m"),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v(")")])]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("/tmp/docker-machine "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("&&")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" /tmp/docker-machine /usr/local/bin/docker-machine\n")])])]),t("p",[a._v("这个岂止是慢，根本就没速度，所以采用手动安装，先去"),t("code",[a._v("https://github.com/docker/machine/releases/")]),a._v("下载，这里下载也得翻墙==")]),a._v(" "),t("p",[a._v("下载好安装：")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" docker-machine-Linux-x86_64 /usr/local/bin/docker-machine\n")])])]),t("p",[a._v("验证：")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("$ docker-machine version\n\ndocker-machine version "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("0.16")]),a._v(".0, build 702c267f\n")])])]),t("h3",{attrs:{id:"创建虚拟机集群"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#创建虚拟机集群"}},[a._v("#")]),a._v(" 创建虚拟机集群")]),a._v(" "),t("p",[a._v("安装virtualbox驱动：")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("apt")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" virtualbox\n")])])]),t("p",[a._v("创建名为"),t("code",[a._v("myvm1")]),a._v("的虚拟机：")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("$ docker-machine create --driver virtualbox myvm1\n\nRunning pre-create checks"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("..")]),a._v(".\nError with pre-create check: "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"This computer doesn\'t have VT-X/AMD-v enabled. Enabling it in the BIOS is mandatory"')]),a._v("\n")])])]),t("p",[a._v("出现错误，这里使用的是VMware，解决：")]),a._v(" "),t("p",[t("img",{attrs:{src:"https://img-blog.csdnimg.cn/2019031301111025.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L1RLREtfYm90,size_16,color_FFFFFF,t_70",alt:"在这里插入图片描述"}})]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("$ docker-machine create --driver virtualbox myvm1\n\nRunning pre-create checks"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("..")]),a._v(".\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("myvm1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" No default Boot2Docker ISO found locally, downloading the latest release"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("..")]),a._v(".\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("myvm1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" Latest release "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("for")]),a._v(" github.com/boot2docker/boot2docker is v18.09.3\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("myvm1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" Downloading /home/vczyh/.docker/machine/cache/boot2docker.iso from https://github.com/boot2docker/boot2docker/releases/download/v18.09.3/boot2docker.iso"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("..")]),a._v(".\n")])])]),t("p",[a._v("从github下载"),t("code",[a._v("iso")]),a._v("文件非常慢，"),t("a",{attrs:{href:"https://github.com/boot2docker/boot2docker/releases",target:"_blank",rel:"noopener noreferrer"}},[a._v("采用手动下载"),t("OutboundLink")],1),a._v("，"),t("a",{attrs:{href:"https://segmentfault.com/a/1190000017001848",target:"_blank",rel:"noopener noreferrer"}},[a._v("参考"),t("OutboundLink")],1),a._v("：")]),a._v(" "),t("p",[a._v("把"),t("code",[a._v("iso")]),a._v("文件放到默认位置：")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("cp")]),a._v(" boot2docker.iso ~/.docker/machine/cache/\n")])])]),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("$ docker-machine create --driver virtualbox myvm1\n\nRunning pre-create checks"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("..")]),a._v(".\nCreating machine"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("..")]),a._v(".\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("myvm1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" Copying /home/vczyh/.docker/machine/cache/boot2docker.iso to /home/vczyh/.docker/machine/machines/myvm1/boot2docker.iso"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("..")]),a._v(".\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("myvm1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" Creating VirtualBox VM"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("..")]),a._v(".\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("myvm1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" Creating SSH key"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("..")]),a._v(".\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("myvm1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" Starting the VM"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("..")]),a._v(".\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("myvm1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" Check network to re-create "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("if")]),a._v(" needed"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("..")]),a._v(".\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("myvm1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" Found a new host-only adapter: "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"vboxnet0"')]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("myvm1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" Waiting "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("for")]),a._v(" an IP"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("..")]),a._v(".\nWaiting "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("for")]),a._v(" machine to be running, this may take a few minutes"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("..")]),a._v(".\nDetecting operating system of created instance"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("..")]),a._v(".\nWaiting "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("for")]),a._v(" SSH to be available"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("..")]),a._v(".\nDetecting the provisioner"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("..")]),a._v(".\nProvisioning with boot2docker"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("..")]),a._v(".\nCopying certs to the "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("local")]),a._v(" machine directory"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("..")]),a._v(".\nCopying certs to the remote machine"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("..")]),a._v(".\nSetting Docker configuration on the remote daemon"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("..")]),a._v(".\nChecking connection to Docker"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("..")]),a._v(".\nDocker is up and running"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("!")]),a._v("\nTo see how to connect your Docker Client to the Docker Engine running on this virtual machine, run: docker-machine "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("env")]),a._v(" myvm1\n\n")])])]),t("p",[a._v("同样，再创建一个名为"),t("code",[a._v("myvm2")]),a._v("的虚拟机：")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("docker-machine create --driver virtualbox myvm2\n")])])]),t("p",[a._v("查看虚拟机：")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("$ docker-machine "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("ls")]),a._v("\n\nNAME    ACTIVE   DRIVER       STATE     URL                         SWARM   DOCKER     ERRORS\nmyvm1   -        virtualbox   Running   tcp://192.168.99.100:2376           v18.09.3   \nmyvm2   -        virtualbox   Running   tcp://192.168.99.101:2376           v18.09.3  \n")])])]),t("h3",{attrs:{id:"连接虚拟机"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#连接虚拟机"}},[a._v("#")]),a._v(" 连接虚拟机")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("$ docker-machine --native-ssh "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("ssh")]),a._v(" myvm1\ndocker@myvm1:~$ \n")])])]),t("h3",{attrs:{id:"初始化swarm以及添加节点"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#初始化swarm以及添加节点"}},[a._v("#")]),a._v(" 初始化swarm以及添加节点")]),a._v(" "),t("p",[a._v("连接"),t("code",[a._v("myvm1")]),a._v("后：指定"),t("code",[a._v("myvm1")]),a._v("为"),t("code",[a._v("swarm manager")]),a._v("，"),t("code",[a._v("192.168.99.100")]),a._v("是"),t("code",[a._v("myvm1")]),a._v("的IP")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("docker@myvm1:~$ docker swarm init --advertise-addr "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("192.168")]),a._v(".99.100\n\nSwarm initialized: current node "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("nvjzr75vnm3mkil2kkhd6jgf3"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" is now a manager.\n\nTo "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("add")]),a._v(" a worker to this swarm, run the following command:\n\n    docker swarm "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("join")]),a._v(" --token SWMTKN-1-52s3754sf6z3593m63vxp4augov6f8j1cqaj2xohus6q4awzkf-2z623eefvtduazuqljwjjw8s8 "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("192.168")]),a._v(".99.100:2377\n\nTo "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("add")]),a._v(" a manager to this swarm, run "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'docker swarm join-token manager'")]),a._v(" and follow the instructions.\n")])])]),t("p",[t("code",[a._v("CTRL+D")]),a._v("退出连接，连接"),t("code",[a._v("myvm2")]),a._v("后：设置"),t("code",[a._v("myvm2")]),a._v("为"),t("code",[a._v("swarm worker")])]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("docker@myvm2:~$ docker swarm "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("join")]),a._v(" --token SWMTKN-1-52s3754sf6z3593m63vxp4augov6f8j1cqaj2xohus6q4awzkf-2z623eefvtduazuqljwjjw8s8 \n"),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("192.168")]),a._v(".99.100:2377\n\nThis node joined a swarm as a worker.\n")])])]),t("p",[a._v("现在一个swarm已经创建完成")]),a._v(" "),t("p",[a._v("在"),t("code",[a._v("swarm manager(myvm1)")]),a._v("中查看所有节点：")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("docker@myvm1:~$ docker node "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("ls")]),a._v("\n\nID                            "),t("span",{pre:!0,attrs:{class:"token environment constant"}},[a._v("HOSTNAME")]),a._v("            STATUS              AVAILABILITY        MANAGER STATUS      ENGINE VERSION\nnvjzr75vnm3mkil2kkhd6jgf3 *   myvm1               Ready               Active              Leader              "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("18.09")]),a._v(".3\njjm2wnew5n6t1wy1oaxqa0y5l     myvm2               Ready               Active                                  "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("18.09")]),a._v(".3\n")])])]),t("h3",{attrs:{id:"另外一种与虚拟机对话方式"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#另外一种与虚拟机对话方式"}},[a._v("#")]),a._v(" 另外一种与虚拟机对话方式")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("$ docker-machine "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("env")]),a._v(" myvm1\n\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("export")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("DOCKER_TLS_VERIFY")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"1"')]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("export")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("DOCKER_HOST")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"tcp://192.168.99.100:2376"')]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("export")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("DOCKER_CERT_PATH")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"/Users/sam/.docker/machine/machines/myvm1"')]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("export")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("DOCKER_MACHINE_NAME")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"myvm1"')]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# Run this command to configure your shell:")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# eval $(docker-machine env myvm1)")]),a._v("\n")])])]),t("p",[a._v("运行：")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("eval")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$(")]),a._v("docker-machine "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("env")]),a._v(" myvm1"),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v(")")])]),a._v("\n")])])]),t("p",[a._v("现在实现了和ssh连接"),t("code",[a._v("myvm1")]),a._v("相同的结果:")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("docker node "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("ls")]),a._v("\n")])])]),t("p",[a._v("好处之一就是虚拟机可以直接使用宿主机的文件")]),a._v(" "),t("p",[t("strong",[a._v("断开对话：")])]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("eval")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$(")]),a._v("docker-machine "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("env")]),a._v(" -u"),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v(")")])]),a._v("\n")])])]),t("h3",{attrs:{id:"部署应用到swarm"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#部署应用到swarm"}},[a._v("#")]),a._v(" 部署应用到swarm")]),a._v(" "),t("p",[a._v("使用"),t("code",[a._v("eval $(docker-machine env myvm1)")]),a._v("打开与"),t("code",[a._v("myvm1")]),a._v("的对话")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("$ docker stack deploy -c docker-compose.yml getstartedlab\n\nCreating network getstartedlab_webnet\nCreating "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("service")]),a._v(" getstartedlab_web\n")])])]),t("p",[a._v("如果"),t("code",[a._v("docker-compose.yml")]),a._v("里使用的镜像不是"),t("code",[a._v("Docker Hub")]),a._v("的：")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("docker login registry.example.com\n\ndocker stack deploy --with-registry-auth -c docker-compose.yml getstartedlab\n")])])]),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("$ docker stack "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("ps")]),a._v(" getstartedlab \nID                  NAME                  IMAGE                                                     NODE                DESIRED STATE       CURRENT STATE                ERROR               PORTS\nyb5xbwt75478        getstartedlab_web.1   registry.cn-hangzhou.aliyuncs.com/zhangyuheng/hello:1.0   myvm2               Running             Running about a minute ago                       \nqv2kkg1pv4nk        getstartedlab_web.2   registry.cn-hangzhou.aliyuncs.com/zhangyuheng/hello:1.0   myvm1               Running             Running about a minute ago                       \n9xv233qkma2c        getstartedlab_web.3   registry.cn-hangzhou.aliyuncs.com/zhangyuheng/hello:1.0   myvm2               Running             Running about a minute ago                       \nnkh19eyoc461        getstartedlab_web.4   registry.cn-hangzhou.aliyuncs.com/zhangyuheng/hello:1.0   myvm2               Running             Running about a minute ago                       \nltgvcey52qcc        getstartedlab_web.5   registry.cn-hangzhou.aliyuncs.com/zhangyuheng/hello:1.0   myvm1               Running  \n")])])]),t("p",[a._v("现在5个实例(容器)已经分布在俩个虚拟机中")]),a._v(" "),t("p",[a._v("查看"),t("code",[a._v("myvm1")]),a._v("的容器：其他的3个实例在"),t("code",[a._v("myvm2")]),a._v("中")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("$ docker container "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("ls")]),a._v("\n\nCONTAINER ID        IMAGE                                                     COMMAND             CREATED             STATUS              PORTS               NAMES\n2f078db7d57d        registry.cn-hangzhou.aliyuncs.com/zhangyuheng/hello:1.0   "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"python app.py"')]),a._v("     "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("2")]),a._v(" minutes ago       Up "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("2")]),a._v(" minutes        "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("80")]),a._v("/tcp              getstartedlab_web.2.qv2kkg1pv4nka4mspfo20byfj\n65dd11245584        registry.cn-hangzhou.aliyuncs.com/zhangyuheng/hello:1.0   "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"python app.py"')]),a._v("     "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("2")]),a._v(" minutes ago       Up "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("2")]),a._v(" minutes        "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("80")]),a._v("/tcp              getstartedlab_web.5.ltgvcey52qccemijo4fldp9ky\n\n")])])]),t("h3",{attrs:{id:"测试-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#测试-2"}},[a._v("#")]),a._v(" 测试")]),a._v(" "),t("p",[a._v("宿主机运行："),t("code",[a._v("192.168.99.101")]),a._v("是任意一个虚拟机的IP")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("curl")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("192.168")]),a._v(".99.101:4000\n")])])]),t("p",[a._v("每次访问的"),t("code",[a._v("Hostname")]),a._v("不同，证实了集群的负载均衡")]),a._v(" "),t("h3",{attrs:{id:"拓展应用-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#拓展应用-2"}},[a._v("#")]),a._v(" 拓展应用")]),a._v(" "),t("p",[a._v("第一种：修改"),t("code",[a._v("docker-compose.yml")])]),a._v(" "),t("p",[a._v("第二种：使用"),t("code",[a._v("docker swarm join")]),a._v("为集群添加机器")]),a._v(" "),t("p",[a._v("这俩种操作之后，重新执行"),t("code",[a._v("docker stack deploy -c docker-compose.yml getstartedlab")])]),a._v(" "),t("h3",{attrs:{id:"关闭应用"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#关闭应用"}},[a._v("#")]),a._v(" 关闭应用")]),a._v(" "),t("p",[a._v("关闭"),t("code",[a._v("stack")])]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("docker stack "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("rm")]),a._v(" getstartedlab\n")])])]),t("p",[a._v("关闭"),t("code",[a._v("swarm")]),a._v(":")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("docker swarm leave  // worker\ndocker swarm leave --force // manager\n")])])]),t("h3",{attrs:{id:"常用命令-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#常用命令-2"}},[a._v("#")]),a._v(" 常用命令")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("docker-machine create --driver virtualbox myvm1 "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# Create a VM (Mac, Win7, Linux)")]),a._v("\ndocker-machine create -d hyperv --hyperv-virtual-switch "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"myswitch"')]),a._v(" myvm1 "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# Win10")]),a._v("\ndocker-machine "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("env")]),a._v(" myvm1                "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# View basic information about your node")]),a._v("\ndocker-machine "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("ssh")]),a._v(" myvm1 "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"docker node ls"')]),a._v("         "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# List the nodes in your swarm")]),a._v("\ndocker-machine "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("ssh")]),a._v(" myvm1 "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"docker node inspect <node ID>"')]),a._v("        "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# Inspect a node")]),a._v("\ndocker-machine "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("ssh")]),a._v(" myvm1 "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"docker swarm join-token -q worker"')]),a._v("   "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# View join token")]),a._v("\ndocker-machine "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("ssh")]),a._v(" myvm1   "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v('# Open an SSH session with the VM; type "exit" to end')]),a._v("\ndocker node "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("ls")]),a._v("                "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# View nodes in swarm (while logged on to manager)")]),a._v("\ndocker-machine "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("ssh")]),a._v(" myvm2 "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"docker swarm leave"')]),a._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# Make the worker leave the swarm")]),a._v("\ndocker-machine "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("ssh")]),a._v(" myvm1 "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"docker swarm leave -f"')]),a._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# Make master leave, kill swarm")]),a._v("\ndocker-machine "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("ls")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# list VMs, asterisk shows which VM this shell is talking to")]),a._v("\ndocker-machine start myvm1            "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# Start a VM that is currently not running")]),a._v("\ndocker-machine "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("env")]),a._v(" myvm1      "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# show environment variables and command for myvm1")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("eval")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$(")]),a._v("docker-machine "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("env")]),a._v(" myvm1"),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v(")")])]),a._v("         "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# Mac command to connect shell to myvm1")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("&")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"C:\\Program Files\\Docker\\Docker\\Resources'),t("span",{pre:!0,attrs:{class:"token entity",title:"\\b"}},[a._v("\\b")]),a._v('in\\docker-machine.exe"')]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("env")]),a._v(" myvm1 "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" Invoke-Expression   "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# Windows command to connect shell to myvm1")]),a._v("\ndocker stack deploy -c "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("file"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("app"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# Deploy an app; command shell must be set to talk to manager (myvm1), uses local Compose file")]),a._v("\ndocker-machine "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("scp")]),a._v(" docker-compose.yml myvm1:~ "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# Copy file to node's home dir (only required if you use ssh to connect to manager and deploy the app)")]),a._v("\ndocker-machine "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("ssh")]),a._v(" myvm1 "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"docker stack deploy -c <file> <app>"')]),a._v("   "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# Deploy an app using ssh (you must have first copied the Compose file to myvm1)")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("eval")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$(")]),a._v("docker-machine "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("env")]),a._v(" -u"),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v(")")])]),a._v("     "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# Disconnect shell from VMs, use native docker")]),a._v("\ndocker-machine stop "),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$(")]),a._v("docker-machine "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("ls")]),a._v(" -q"),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v(")")])]),a._v("               "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# Stop all running VMs")]),a._v("\ndocker-machine "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("rm")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$(")]),a._v("docker-machine "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("ls")]),a._v(" -q"),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v(")")])]),a._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# Delete all VMs and their disk images")]),a._v("\n")])])]),t("h2",{attrs:{id:"docker其他配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#docker其他配置"}},[a._v("#")]),a._v(" Docker其他配置")]),a._v(" "),t("h3",{attrs:{id:"镜像配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#镜像配置"}},[a._v("#")]),a._v(" 镜像配置")]),a._v(" "),t("p",[t("code",[a._v("/etc/docker/daemon.json")])]),a._v(" "),t("div",{staticClass:"language-json extra-class"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[a._v('"registry-mirrors"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"http://141e5461.m.daocloud.io"')]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])])]),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("service")]),a._v(" docker restart\n")])])]),t("h3",{attrs:{id:"dns配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#dns配置"}},[a._v("#")]),a._v(" DNS配置")]),a._v(" "),t("p",[a._v("Docker实例里的DNS可能出问题，所以配置Docker使用的DNS")]),a._v(" "),t("p",[t("code",[a._v("/etc/docker/daemon.json")])]),a._v(" "),t("div",{staticClass:"language-json extra-class"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[a._v('"dns"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"your_dns_address"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"8.8.8.8"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])])]),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("service")]),a._v(" docker restart\n")])])])])}),[],!1,null,null,null);s.default=n.exports}}]);