(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{499:function(t,a,s){"use strict";s.r(a);var e=s(4),n=Object(e.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h2",{attrs:{id:"环境"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#环境"}},[t._v("#")]),t._v(" 环境")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("IP")]),t._v(" "),s("th",[t._v("Hostname")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("192.168.30.128")]),t._v(" "),s("td",[t._v("node1")])]),t._v(" "),s("tr",[s("td",[t._v("192.168.30.129")]),t._v(" "),s("td",[t._v("node2")])]),t._v(" "),s("tr",[s("td",[t._v("192.168.30.130")]),t._v(" "),s("td",[t._v("node3")])])])]),t._v(" "),s("h2",{attrs:{id:"_1-配置-hosts"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-配置-hosts"}},[t._v("#")]),t._v(" 1. 配置 Hosts")]),t._v(" "),s("p",[t._v("分别为每个节点配置Hosts，打开 "),s("code",[t._v("/etc/hosts")]),t._v("，添加以下内容。")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("192.168.30.128 node1\n192.168.30.129 node2\n192.168.30.130 node3\n")])])]),s("h2",{attrs:{id:"_2-安装-rabbitmq"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-安装-rabbitmq"}},[t._v("#")]),t._v(" 2. 安装 RabbitMQ")]),t._v(" "),s("p",[t._v("需要为每个节点安装 RabbitMQ 服务（指的是erlang服务）和应用（指的是rabbitMQ应用）。这里环境为 Ubuntu，直接使用官方提供的脚本安装。其他安装方式或者其他系统安装可以参考 "),s("a",{attrs:{href:"https://www.rabbitmq.com/download.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("官方文档"),s("OutboundLink")],1),t._v("。")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token shebang important"}},[t._v("#!/bin/sh")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## If sudo is not available on the system,")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## uncomment the line below to install it")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# apt-get install -y sudo")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("apt-get")]),t._v(" update -y\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## Install prerequisites")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("apt-get")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl")]),t._v(" gnupg -y\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## Install RabbitMQ signing key")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl")]),t._v(" -fsSL https://github.com/rabbitmq/signing-keys/releases/download/2.0/rabbitmq-release-signing-key.asc "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" apt-key "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("add")]),t._v(" -\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## Install apt HTTPS transport")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("apt-get")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" apt-transport-https\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## Add Bintray repositories that provision latest RabbitMQ and Erlang 23.x releases")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("tee")]),t._v(" /etc/apt/sources.list.d/bintray.rabbitmq.list "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('EOF\n## Installs the latest Erlang 23.x release.\n## Change component to "erlang-22.x" to install the latest 22.x version.\n## "bionic" as distribution name should work for any later Ubuntu or Debian release.\n## See the release to distribution mapping table in RabbitMQ doc guides to learn more.\ndeb https://dl.bintray.com/rabbitmq-erlang/debian bionic erlang\n## Installs latest RabbitMQ release\ndeb https://dl.bintray.com/rabbitmq/debian bionic main\nEOF')]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## Update package indices")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("apt-get")]),t._v(" update -y\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## Install rabbitmq-server and its dependencies")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("apt-get")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" rabbitmq-server -y --fix-missing\n")])])]),s("p",[t._v("安装以后，服务自动启动，默认开启两个端口（同一个进程），"),s("code",[t._v("25672")]),t._v("为集群通信提供服务，"),s("code",[t._v("5672")]),t._v("为客户端提供服务，客户端连接的就是这个端口。")]),t._v(" "),s("h2",{attrs:{id:"_3-配置-cookie"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-配置-cookie"}},[t._v("#")]),t._v(" 3. 配置 Cookie")]),t._v(" "),s("p",[t._v("集群通过 Cookie 进行验证，需要将所有节点的 Cookie 配置统一，这里将 node1 节点的 Cookie 值复制到其他节点。Cookie 文件的默认路径为 "),s("code",[t._v("/var/lib/rabbitmq/.erlang.cookie")]),t._v("，如果不是通过包管理器安装，路径为"),s("code",[t._v("$HOME/.erlang.cookie")]),t._v("。")]),t._v(" "),s("h2",{attrs:{id:"_4-配置集群"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-配置集群"}},[t._v("#")]),t._v(" 4. 配置集群")]),t._v(" "),s("p",[t._v("这一步会将各个独立的节点配置成一个集群。在配置之前，可以通过"),s("code",[t._v("rabbitmqctl cluster_status")]),t._v("查看集群状态。")]),t._v(" "),s("p",[t._v("以 node2 节点为例，如果程序正在运行，你可以通过命令停止应用。")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("rabbitmqctl stop_app\n")])])]),s("p",[t._v("将节点加入到集群当中，可以加入 node1 或者 node3，各个节点是平等的，这只会影响后面的操作顺序。")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("rabbitmqctl join_cluster rabbit@node1\n")])])]),s("p",[t._v("启动应用。")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("rabbitmqctl start_app\n")])])]),s("p",[t._v("再次通过"),s("code",[t._v("rabbitmqctl cluster_status")]),t._v("查看集群状态，与配置之前对比一下。")]),t._v(" "),s("p",[t._v("同理，可以通过以下命令将 node3 节点加入到集群当中。")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("rabbitmqctl stop_app\nrabbitmqctl join_cluster rabbit@node1\nrabbitmqctl start_app\n")])])]),s("h2",{attrs:{id:"_5-web-management"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-web-management"}},[t._v("#")]),t._v(" 5. Web Management")]),t._v(" "),s("p",[t._v("RabbitMQ 官方提供了 "),s("code",[t._v("rabbitmq_management")]),t._v("插件，方便通过 Web 页面进行管理。")]),t._v(" "),s("p",[t._v("通过命令安装。")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("rabbitmq-plugins "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("enable")]),t._v(" rabbitmq_management\n")])])]),s("p",[t._v("完成后，访问"),s("code",[t._v("http://IP:15672")]),t._v("即可。默认的"),s("code",[t._v("guest")]),t._v("用户只能在本地登录，远程登录需要创建新用户。如果是集群的话，只需要在任意一个节点设置用户，会自动同步到整个集群。")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("rabbitmqctl add_user admin admin\n")])])]),s("p",[t._v("此时，并不能登录，需要为用户设置角色，"),s("code",[t._v("administrator")]),t._v("角色可以登录 Web 页面。")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("rabbitmqctl set_user_tags admin administrator\n")])])]),s("p",[t._v("为了客户端使用该账号，需要赋予一定的权限。")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("rabbitmqctl set_permissions -p / admin "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('".*"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('".*"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('".*"')]),t._v("\n")])])]),s("p",[t._v("至此，一个简单的集群搭建完毕。")])])}),[],!1,null,null,null);a.default=n.exports}}]);